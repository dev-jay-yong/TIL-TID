# 테스트코드

### 개요
오늘은 테스트코드에 대해서 알아 볼 것이다. 사실 테스트코드를 작성한 경험은 많았지만 제대로 공부하고 작성을 한 적은 없었다.
그러다보니 테스트코드이 유지보수나 커버리지등 여러 부분에서 지속적으로 문제가 발생했었다. 이러한 문제를 많이 늦었지만 지금이라도 고치기 위하여 오늘은 테스트코드에 대해서 알아 볼 것이다.

이번 글은 [파이콘 2018 한성민님 발표](https://www.youtube.com/watch?v=S5SY2pkmOy0) 와 여러 기술블로그를 참고하여 만들었다.

---

### 테스트 코드는 왜 필요할까?
가장 원초적인 질문을 던져보자. 테스트코드는 왜 필요할까? 아래 사진과같은 product 구조에 새로운 메소드를 추가한다고 가정해보자.
<img width="1134" alt="테스트코드1" src="https://user-images.githubusercontent.com/96015600/164889916-f2621ce5-cbd7-4c9c-8a3f-4539982e58ca.png">
(이미지 출처 [파이콘 2018 한성민님 발표](https://www.youtube.com/watch?v=S5SY2pkmOy0))

위 이미지에서 확인 할 수 있듯이 한개의 메소드를 추가했을 뿐인데 굉장히 많은 메소드 및 Feature, API 들과 연결되어있다.
즉, 우리는 이 메소드를 하나 추가함으로써 기존처럼 기능이 정상적으로 동작하는지를 체크하기 위해 무수히 많은 테스트를 <b>수동으로</b> 진행해야 하는 것이다.
물론 이 과정에서 100% 누락없이 테스트를 진행하는 것은 신만 가능할 것이다. ~~아쉽게도 우린 신이 아니다~~

만약 개발자가 테스트 과정에서 누락이 발생한다면 아래 사진과 같이 최악의 경우 사용자에게 직접적인 영향을 끼치는 API 단계에서 에러가 발생할 수 있다. ~~끔찍하다~~
<img width="1116" alt="테스트코드2" src="https://user-images.githubusercontent.com/96015600/164889918-f12637fb-342e-4c08-b856-f4f372bb2993.png">
(이미지 출처 [파이콘 2018 한성민님 발표](https://www.youtube.com/watch?v=S5SY2pkmOy0))

즉 항상 모든 기능이 정상적으로 동작하는지 체크하고 테스트하고 결과를 알려주는 자동화 작업이 필요한것이다.
이 작업을 수행하는 코드가 바로 <b>테스트 코드</b>이다.

테스트코드가 갖춰진다면 개발자는 비교적 마음 편하게 개발을 진행할 것이고 당연히 리팩토링 역시 비교적 가벼운 마음으로 여러 시도를 해보며 진행할 수 있을것이다.
테스트코드가 갖춰짐으로써 코드의 퀄리티, 안전성, 개발속도 삼박자에 모두 도움을 주는 것이다. 그 만큼 최근 개발 트렌드에서 테스트코드의 입지는 점점 높아지고 있다.

마지막으로 바쁜사람들을 위해 테스트코드의 장점을 간단하게 정리하자면 아래와 같다.
1. 기능 개발 후 서버 배포 후 테스트까지의 시간을 단축 시킬 수 있다.
2. 단위 테스트의 경우 테스트 완료까지의 시간이 매우 짧다.
3. 문서로써의 역할이 가능하며 인수인계 과정이나 본인의 코드를 되돌아 볼 때 발생하는 비용이 절감된다.
4. 전체적인 코드의 안정성을 높여주며 낮은 리스크로 코드 리팩토링을 가능하게 해준다.

---

### 테스트 코드 방식
<img width="1112" alt="테스트코드3" src="https://user-images.githubusercontent.com/96015600/164889920-37cd3f36-2f2f-4984-822f-c88cec10cb09.png">

(이미지 출처 [파이콘 2018 한성민님 발표](https://www.youtube.com/watch?v=S5SY2pkmOy0))

테스트 코드는 위 이미지와 같이 크게 단위, 통합, E2E 테스트로 나누어진다.
각각에 대한 테스트 방식을 정리한 내용은 아래와 같다.

* 단위 테스트 (Unit Test)
    * 메소드, 함수 세부적으로 테스트하는 방법
    * 메소드와 함수의 최소단위와 각 비즈니스 코드의 테스트 등 일반적인 테스트 코드들에 해당.
* 통합 테스트 (Integration Test)
    * API 레벨을 직접 테스트하거나 db, 통합된 코드들을 체크할 때 사용
    * 각종 함수와 메소드가 모여진 코드의 집합을 테스트
    * 실제 사용자가 사용하는 기능들에 대한 테스트 코드들이 해당됨.
* E2E 테스트 (End-to-End Test)
    * UI 단계에서 직접 테스트하는 레벨
    * 사용자가 실제로 사용하는 UI와 같은 복잡한 환경에서 테스트
    * 코드와 상관없이 사용자의 모든 OS나 레지스트리, 메모리등에 대한 모든 결함을 탐지
    * EX) Web UI Test, GUI Program Test, Android App E2E Test 등
  

테스트코드를 처음으로 구축하는 단계라면 대게는 단위 테스트부터 코드작성을 시작하며 필자도 그걸 추천하는 편이다.
테스트코드의 고도화 순서는 대게 단위 -> 통합 -> E2E 순으로 개발하는 것이 좋다고 평가한다.
세부적인 기능 부터 확실한 안정화 작업을 완료한 뒤 다음단계로 넘어가는 것이다.

---
    
### 테스트코드 특징
테스트 코드는 크게 2가지방식으로 나누게 되는데 흔히 White Box Test 와 Black Box Test로 나누게 된다.

- White Box Test
    - 코드의 내부를 들여다보고 테스트를 진행하는 방식
- Black Box Test
    - 코드의 내부를 모르는 상태에서 입력값과 출력값만으로 진행하는 방식

<img width="1069" alt="테스트코드4" src="https://user-images.githubusercontent.com/96015600/164889922-fad09e7d-324f-4caf-94bc-856a9229931b.png"> 

(이미지 출처 [파이콘 2018 한성민님 발표](https://www.youtube.com/watch?v=S5SY2pkmOy0))

위 이미지에서 확인 할 수 있듯 white box와 black box 테스트의 경우 각각 중요하게 생각하는 목표가 다르다.

White Box의 경우에는 코드 내부를 모두 들여다보고 작성을 하다보니 코드의 분기점을 모두 고려해서 코드를 작성하게 된다. 물론 이 과정에서 커버리지를 측정하게 되고 커버리지가 높을수록 코드의 안정성이 높아진다. (항상 그런 것은 아니다.)

반면 Black Box의 경우 코드 내부를 들여다보고 작성을 하지 않기 때문에 if 문과 같은 분기점을 일일이 고려할 수 없다.
대신 input값과 output 값 한쌍이 이루어져 있는 테스트 케이스를 최대한 많이 만들어 여러 상황을 고려하여 테스트코드를 작성하게된다.
물론 이런 테스트 케이스는 많을수록 안정성은 상대적으로 높아 질 수 있다.

보통 White Box Test의 경우는 단위 테스트를 진행할 때 사용하게 되며 통합테스트나 E2E 테스트의 경우 아래 이미지와 같이 Black Box 테스트 방식으로 많이 작성하게 된다.

<img width="1131" alt="테스트코드5" src="https://user-images.githubusercontent.com/96015600/164889925-fb4a2496-792b-4eaa-a228-7aeb70f1dc90.png">

(이미지 출처 [파이콘 2018 한성민님 발표](https://www.youtube.com/watch?v=S5SY2pkmOy0))

---

### 마무리
오늘은 테스트코드의 이론적인 부분을 위주로 알아보았다. 테스트코드는 어떻게 다르며 어떤 상황에서 어떤 방식으로 테스트코드를 작성하는것이 바람직한지 알아보는 시간이 된 거 같다.
~~지금 당장 내 개인 프로젝트부터 회사 테스트코드까지 개편이 시급하다는 것도 알았다~~

이번글은 여기서 마무리를 짓고 다음 글에서는 테스트 주도 개발(TDD)기법과 실제로 파이썬을 통해 간단한 테스트코드를 작성해보도록 하겠다.

---

### 참고 및 이미지 등 출처
1. [파이콘 2018 한성민님 발표](https://www.youtube.com/watch?v=S5SY2pkmOy0)
2. [진짜 개발자님 기술블로그](https://galid1.tistory.com/783)
3. [ronda.ha님의 카카오 기술블로그 글](https://tech.kakao.com/2021/11/08/test-code/)
4. [브랜드 랩스 기술블로그](http://labs.brandi.co.kr/2018/06/07/kwakjs.html)
5. [이규원 개발자님의 TDD 동영상](https://www.youtube.com/watch?v=N5WyUEwY0DY)

